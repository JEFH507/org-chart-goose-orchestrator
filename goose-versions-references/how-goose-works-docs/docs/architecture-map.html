<!doctype html>
<html>
<head>
<meta charset="utf-8" />
<title>Goose Architecture Map</title>
<script>
  (function(){
    const saved = localStorage.getItem('theme') || 'dark';
    document.documentElement.setAttribute('data-theme', saved);
  })();
</script>
<style>
  :root[data-theme="dark"]{ --bg:#0b1220; --panel:#0f172a; --border:#1f2a44; --text:#e2e8f0; --muted:#93a4bc; --link:#60a5fa; }
  :root[data-theme="light"]{ --bg:#ffffff; --panel:#ffffff; --border:#e2e8f0; --text:#0f172a; --muted:#475569; --link:#2563eb; }
  body { font-family: Inter, ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Arial, sans-serif; margin: 0; color: var(--text); background: var(--bg); }
  .wrap { max-width: 980px; margin: 0 auto; padding: 24px; }
  .toolbar { display:flex; justify-content: space-between; align-items:center; margin-bottom:12px; }
  .toolbar h1 { margin: 0; font-weight: 700; }
  .toolbar button { background:none; border:1px solid var(--border); color:var(--text); padding:6px 10px; border-radius:8px; cursor:pointer; }
  .toolbar button:hover { border-color: var(--link); }
  .meta { color: var(--muted); font-size: 0.95em; }
  .grid { display: grid; grid-template-columns: 1fr; gap: 18px; }
  .diag { border: 1px solid var(--border); background: var(--panel); padding: 10px; border-radius: 8px; }
  img { max-width: 100%; height: auto; }
  ul { margin-top: 6px; }
  .small { font-size: 0.95em; }
  a { color: var(--link); text-decoration: none; }
  a:hover { text-decoration: underline; }
</style>
</head>
<body>
  <div class="wrap">
    <div class="toolbar">
      <h1>Goose Architecture Map</h1>
      <button id="themeToggle">Toggle theme</button>
    </div>
    <p class="meta">One-page reference of Goose components, relationships, and flows.</p>

    <h2>System Architecture</h2>
    <div class="diag"><img src="../diagrams/mermaid/system_architecture.png" alt="System Architecture"></div>

    <h2>Agent Engine Modules</h2>
    <div class="diag"><img src="../diagrams/mermaid/agent_engine_modules.png" alt="Agent Engine Modules"></div>

    <h2>Interactive Loop</h2>
    <div class="diag"><img src="../diagrams/mermaid/interactive_loop.png" alt="Interactive Loop"></div>

    <h2>Key Components</h2>
    <div class="diag small">
      <ul>
        <li><strong>Interface</strong>: Desktop (Electron), CLI, ACP clients</li>
        <li><strong>Server</strong>: goose-server (goosed), OpenAPI consumed by UI</li>
        <li><strong>Agent Engine</strong>: core loop, tool routing, providers, prompts, context, permissions, security, scheduler, logging</li>
        <li><strong>Extensions</strong>: MCP-based built-in and external servers exposing tools</li>
        <li><strong>Scheduler</strong>: temporal-service (Go) with agent-side scheduler modules</li>
        <li><strong>Config</strong>: ~/.config/goose/config.yaml and environment variables</li>
        <li><strong>Logs & Storage</strong>: history.txt, sessions/*.jsonl, cli/server logs</li>
        <li><strong>Security</strong>: permission modes, per-tool permissions, prompt-injection detection</li>
        <li><strong>Error Handling</strong>: surfaces tool errors to LLM for self-recovery</li>
      </ul>
    </div>

    <p class="meta">Back to <a href="../../../docs/architecture/index.html">Architecture Tour</a></p>
  </div>
  <script>
    document.getElementById('themeToggle').addEventListener('click', function(){
      const cur = document.documentElement.getAttribute('data-theme') || 'dark';
      const next = (cur === 'dark') ? 'light' : 'dark';
      localStorage.setItem('theme', next);
      location.reload();
    });
  </script>
</body>
</html>
